!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).supercluster=t()}}(function(){return function i(s,u,a){function h(o,t){if(!u[o]){if(!s[o]){var n="function"==typeof require&&require;if(!t&&n)return n(o,!0);if(p)return p(o,!0);var e=new Error("Cannot find module '"+o+"'");throw e.code="MODULE_NOT_FOUND",e}var r=u[o]={exports:{}};s[o][0].call(r.exports,function(t){return h(s[o][1][t]||t)},r,r.exports,i,s,u,a)}return u[o].exports}for(var p="function"==typeof require&&require,t=0;t<a.length;t++)h(a[t]);return h}({1:[function(t,o,n){"use strict";var p=t("kdbush");o.exports=e,o.exports.default=e;var r="EPSG:3857";function e(t){return new i(t)}function i(t){if(this.options=s(Object.create(this.options),t),this.trees=new Array(this.options.maxZoom+1),-1===["EPSG:3857","EPSG:4490"].indexOf(this.options.projection))throw new Error("Projection only supports EPSG:3857 or EPSG:4490.");r=this.options.projection}function f(t){return{type:"Feature",properties:a(t),geometry:{type:"Point",coordinates:[(o=t.x,360*(o-.5)),function(t){{if("EPSG:4490"===r)return 90-360*t;var o=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(o))/Math.PI-90}}(t.y)]}};var o}function a(t){var o=t.numPoints,n=1e4<=o?Math.round(o/1e3)+"k":1e3<=o?Math.round(o/100)/10+"k":o;return s(s({},t.properties),{cluster:!0,cluster_id:t.id,point_count:o,point_count_abbreviated:n})}function c(t){return t/360+.5}function d(t){if("EPSG:4490"===r){var o=.25-t/360;return o<0?0:.5<o?.5:o}var n=Math.sin(t*Math.PI/180),e=.5-.25*Math.log((1+n)/(1-n))/Math.PI;return e<0?0:1<e?1:e}function s(t,o){for(var n in o)t[n]=o[n];return t}function l(t){return t.x}function m(t){return t.y}i.prototype={options:{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,projection:"EPSG:3857",reduce:null,initial:function(){return{}},map:function(t){return t}},load:function(t){var o=this.options.log;o&&console.time("total time");var n="prepare "+t.length+" points";o&&console.time(n),this.points=t;for(var e,r,i,s=[],u=0;u<t.length;u++)t[u].geometry&&s.push((e=t[u],r=u,void 0,{x:c((i=e.geometry.coordinates)[0]),y:d(i[1]),zoom:1/0,id:r,parentId:-1}));this.trees[this.options.maxZoom+1]=p(s,l,m,this.options.nodeSize,Float32Array),o&&console.timeEnd(n);for(var a=this.options.maxZoom;a>=this.options.minZoom;a--){var h=+Date.now();s=this._cluster(s,a),this.trees[a]=p(s,l,m,this.options.nodeSize,Float32Array),o&&console.log("z%d: %d clusters in %dms",a,s.length,+Date.now()-h)}return o&&console.timeEnd("total time"),this},getClusters:function(t,o){if(t[0]>t[2]){var n=this.getClusters([t[0],t[1],180,t[3]],o),e=this.getClusters([-180,t[1],t[2],t[3]],o);return n.concat(e)}for(var r=this.trees[this._limitZoom(o)],i=r.range(c(t[0]),d(t[3]),c(t[2]),d(t[1])),s=[],u=0;u<i.length;u++){var a=r.points[i[u]];s.push(a.numPoints?f(a):this.points[a.id])}return s},getChildren:function(t){var o=t>>5,n=t%32,e="No cluster with the specified id.",r=this.trees[n];if(!r)throw new Error(e);var i=r.points[o];if(!i)throw new Error(e);for(var s=this.options.radius/(this.options.extent*Math.pow(2,n-1)),u=r.within(i.x,i.y,s),a=[],h=0;h<u.length;h++){var p=r.points[u[h]];p.parentId===t&&a.push(p.numPoints?f(p):this.points[p.id])}if(0===a.length)throw new Error(e);return a},getLeaves:function(t,o,n){o=o||10,n=n||0;var e=[];return this._appendLeaves(e,t,o,n,0),e},getTile:function(t,o,n){var e=this.trees[this._limitZoom(t)],r=Math.pow(2,t),i=this.options.extent,s=this.options.radius/i,u=(n-s)/r,a=(n+1+s)/r,h={features:[]};return this._addTileFeatures(e.range((o-s)/r,u,(o+1+s)/r,a),e.points,o,n,r,h),0===o&&this._addTileFeatures(e.range(1-s/r,u,1,a),e.points,r,n,r,h),o===r-1&&this._addTileFeatures(e.range(0,u,s/r,a),e.points,-1,n,r,h),h.features.length?h:null},getClusterExpansionZoom:function(t){for(var o=t%32-1;o<this.options.maxZoom;){var n=this.getChildren(t);if(o++,1!==n.length)break;t=n[0].properties.cluster_id}return o},_appendLeaves:function(t,o,n,e,r){for(var i=this.getChildren(o),s=0;s<i.length;s++){var u=i[s].properties;if(u&&u.cluster?r+u.point_count<=e?r+=u.point_count:r=this._appendLeaves(t,u.cluster_id,n,e,r):r<e?r++:t.push(i[s]),t.length===n)break}return r},_addTileFeatures:function(t,o,n,e,r,i){for(var s=0;s<t.length;s++){var u=o[t[s]];i.features.push({type:1,geometry:[[Math.round(this.options.extent*(u.x*r-n)),Math.round(this.options.extent*(u.y*r-e))]],tags:u.numPoints?a(u):this.points[u.id].properties})}},_limitZoom:function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},_cluster:function(t,o){for(var n=[],e=this.options.radius/(this.options.extent*Math.pow(2,o)),r=0;r<t.length;r++){var i=t[r];if(!(i.zoom<=o)){i.zoom=o;var s=this.trees[o+1],u=s.within(i.x,i.y,e),a=i.numPoints||1,h=i.x*a,p=i.y*a,f=null;this.options.reduce&&(f=this.options.initial(),this._accumulate(f,i));for(var c=(r<<5)+(o+1),d=0;d<u.length;d++){var l=s.points[u[d]];if(!(l.zoom<=o)){l.zoom=o;var m=l.numPoints||1;h+=l.x*m,p+=l.y*m,a+=m,l.parentId=c,this.options.reduce&&this._accumulate(f,l)}}1===a?n.push(i):(i.parentId=c,n.push({x:h/a,y:p/a,zoom:1/0,id:c,parentId:-1,numPoints:a,properties:f}))}}return n},_accumulate:function(t,o){var n=o.numPoints?o.properties:this.options.map(this.points[o.id].properties);this.options.reduce(t,n)}}},{kdbush:2}],2:[function(t,o,n){"use strict";var s=t("./sort"),r=t("./range"),e=t("./within");function i(t,o,n,e,r){o=o||u,n=n||a,r=r||Array,this.nodeSize=e||64,this.points=t,this.ids=new r(t.length),this.coords=new r(2*t.length);for(var i=0;i<t.length;i++)this.ids[i]=i,this.coords[2*i]=o(t[i]),this.coords[2*i+1]=n(t[i]);s(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function u(t){return t[0]}function a(t){return t[1]}o.exports=function(t,o,n,e,r){return new i(t,o,n,e,r)},i.prototype={range:function(t,o,n,e){return r(this.ids,this.coords,t,o,n,e,this.nodeSize)},within:function(t,o,n){return e(this.ids,this.coords,t,o,n,this.nodeSize)}}},{"./range":3,"./sort":4,"./within":5}],3:[function(t,o,n){"use strict";o.exports=function(t,o,n,e,r,i,s){var u,a,h=[0,t.length-1,0],p=[];for(;h.length;){var f=h.pop(),c=h.pop(),d=h.pop();if(c-d<=s)for(var l=d;l<=c;l++)u=o[2*l],a=o[2*l+1],n<=u&&u<=r&&e<=a&&a<=i&&p.push(t[l]);else{var m=Math.floor((d+c)/2);u=o[2*m],a=o[2*m+1],n<=u&&u<=r&&e<=a&&a<=i&&p.push(t[m]);var v=(f+1)%2;(0===f?n<=u:e<=a)&&(h.push(d),h.push(m-1),h.push(v)),(0===f?u<=r:a<=i)&&(h.push(m+1),h.push(c),h.push(v))}}return p}},{}],4:[function(t,o,n){"use strict";function g(t,o,n,e){r(t,n,e),r(o,2*n,2*e),r(o,2*n+1,2*e+1)}function r(t,o,n){var e=t[o];t[o]=t[n],t[n]=e}o.exports=function t(o,n,e,r,i,s){if(i-r<=e)return;var u=Math.floor((r+i)/2);!function t(o,n,e,r,i,s){for(;r<i;){if(600<i-r){var u=i-r+1,a=e-r+1,h=Math.log(u),p=.5*Math.exp(2*h/3),f=.5*Math.sqrt(h*p*(u-p)/u)*(a-u/2<0?-1:1),c=Math.max(r,Math.floor(e-a*p/u+f)),d=Math.min(i,Math.floor(e+(u-a)*p/u+f));t(o,n,e,c,d,s)}var l=n[2*e+s],m=r,v=i;for(g(o,n,r,e),n[2*i+s]>l&&g(o,n,r,i);m<v;){for(g(o,n,m,v),m++,v--;n[2*m+s]<l;)m++;for(;n[2*v+s]>l;)v--}n[2*r+s]===l?g(o,n,r,v):g(o,n,++v,i),v<=e&&(r=v+1),e<=v&&(i=v-1)}}(o,n,u,r,i,s%2);t(o,n,e,r,u-1,s+1);t(o,n,e,u+1,i,s+1)}},{}],5:[function(t,o,n){"use strict";function g(t,o,n,e){var r=t-n,i=o-e;return r*r+i*i}o.exports=function(t,o,n,e,r,i){var s=[0,t.length-1,0],u=[],a=r*r;for(;s.length;){var h=s.pop(),p=s.pop(),f=s.pop();if(p-f<=i)for(var c=f;c<=p;c++)g(o[2*c],o[2*c+1],n,e)<=a&&u.push(t[c]);else{var d=Math.floor((f+p)/2),l=o[2*d],m=o[2*d+1];g(l,m,n,e)<=a&&u.push(t[d]);var v=(h+1)%2;(0===h?n-r<=l:e-r<=m)&&(s.push(f),s.push(d-1),s.push(v)),(0===h?l<=n+r:m<=e+r)&&(s.push(d+1),s.push(p),s.push(v))}}return u}},{}]},{},[1])(1)});
